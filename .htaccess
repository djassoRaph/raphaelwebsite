# ==============================================
# SECURITY HEADERS
# ==============================================

<IfModule mod_headers.c>
  # Prevent clickjacking attacks
  Header set X-Frame-Options "SAMEORIGIN"

  # Prevent MIME type sniffing
  Header set X-Content-Type-Options "nosniff"

  # Enable XSS protection
  Header set X-XSS-Protection "1; mode=block"

  # Referrer policy for privacy
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  # Permissions policy (disable unnecessary features)
  Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"

  # Strict Transport Security (force HTTPS)
  # Uncomment when HTTPS is fully configured
  # Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# ==============================================
# DIRECTORY SECURITY
# ==============================================

# Disable directory listing
Options -Indexes

# Protect hidden files (starting with dot)
<FilesMatch "^\.">
  Require all denied
</FilesMatch>

# Block access to sensitive file types
<FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|orig|psd|sh|sql|sw[op])|~)$">
  Require all denied
</FilesMatch>

# Protect git files
<FilesMatch "^\.git">
  Require all denied
</FilesMatch>

# ==============================================
# PUBLIC DIRECTORY ACCESS
# ==============================================

# Allow access to public directory and its subdirectories
<Directory /public>
  Options +FollowSymLinks
  Require all granted
</Directory>

# Keep /public/secret accessible if it exists
<Directory /public/secret>
  Require all granted
</Directory>

# ==============================================
# FILE TYPE SECURITY
# ==============================================

# Allow common web files
<FilesMatch "\.(html|css|js|jpg|jpeg|png|gif|svg|webp|pdf|ico|woff|woff2|ttf|eot|json|xml)$">
  Require all granted
</FilesMatch>

# ==============================================
# PREVENT SCRIPT EXECUTION IN UPLOAD DIRECTORIES
# ==============================================

# Prevent PHP execution in public directory
<Directory /public>
  <FilesMatch "\.(php|phtml|php3|php4|php5|phps)$">
    Require all denied
  </FilesMatch>
</Directory>

# ==============================================
# COMMON EXPLOIT PROTECTION
# ==============================================

# Block common exploit attempts in query strings
<IfModule mod_rewrite.c>
  RewriteEngine On

  # Block SQL injection attempts
  RewriteCond %{QUERY_STRING} (union.*select|insert.*into|delete.*from|drop.*table) [NC]
  RewriteRule .* - [F,L]

  # Block file injection attempts
  RewriteCond %{QUERY_STRING} (\.\.\/|boot\.ini|etc\/passwd|self\/environ) [NC]
  RewriteRule .* - [F,L]

  # Block script injection attempts
  RewriteCond %{QUERY_STRING} (<script|javascript:|eval\(|base64_) [NC,OR]
  RewriteCond %{QUERY_STRING} (GLOBALS|REQUEST)(=|\[|%) [NC]
  RewriteRule .* - [F,L]
</IfModule>

# ==============================================
# PERFORMANCE & CACHING
# ==============================================

# Enable compression for text files
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching for static assets
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# ==============================================
# ERROR PAGES
# ==============================================

# Uncomment and customize error pages if needed
# ErrorDocument 404 /404.html
# ErrorDocument 403 /403.html
# ErrorDocument 500 /500.html
